generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum ProjetoStatus {
  EM_ANDAMENTO
  FINALIZADO
  CANCELADO
}

enum AtividadeStatus {
  PENDENTE
  CONCLUIDA
  PAUSADA
}

enum PagamentoStatus {
  PENDENTE
  PAGO
  FALHOU
}

model Freelancer {
  id        String    @id @default(uuid())
  nome      String
  email     String    @unique
  senha     String
  criadoEm  DateTime  @default(now()) @map("criado_em")
  projetos  Projeto[]

  @@map("freelancer")
}

model Cliente {
  id        String    @id @default(uuid())
  nome      String
  email     String    @unique
  telefone  String?
  criadoEm  DateTime  @default(now()) @map("criado_em")
  projetos  Projeto[]

  @@map("cliente")
}

model Projeto {
  id            String         @id @default(uuid())
  nome          String
  descricao     String?        @db.Text
  status        ProjetoStatus  @default(EM_ANDAMENTO)
  valorTotal    Decimal        @default(0) @map("valor_total") @db.Decimal(10, 2)
  criadoEm      DateTime       @default(now()) @map("criado_em")
  freelancerId  String         @map("freelancer_id")
  clienteId     String         @map("cliente_id")
  
  freelancer    Freelancer     @relation(fields: [freelancerId], references: [id], onDelete: Cascade)
  cliente       Cliente        @relation(fields: [clienteId], references: [id], onDelete: Cascade)
  atividades    Atividade[]
  pagamento     Pagamento?

  @@index([freelancerId])
  @@index([clienteId])

  @@map("projeto")
}

model Atividade {
  id             String           @id @default(uuid())
  descricao      String
  valorHora      Decimal          @map("valor_hora") @db.Decimal(10, 2)
  status         AtividadeStatus  @default(PENDENTE)
  projetoId      String           @map("projeto_id")
  
  projeto        Projeto          @relation(fields: [projetoId], references: [id], onDelete: Cascade)
  registroHoras  RegistroHoras[]

  @@index([projetoId])

  @@map("atividade")
}

model RegistroHoras {
  id              String    @id @default(uuid())
  inicio          DateTime
  fim             DateTime?
  duracaoMinutos  Int?      @map("duracao_minutos")
  atividadeId     String    @map("atividade_id")
  
  atividade       Atividade @relation(fields: [atividadeId], references: [id], onDelete: Cascade)

  @@index([atividadeId])

  @@map("registro_horas")
}

model Pagamento {
  id         String           @id @default(uuid())
  valor      Decimal          @db.Decimal(10, 2)
  status     PagamentoStatus  @default(PENDENTE)
  codigoPix  String?          @map("codigo_pix")
  criadoEm   DateTime         @default(now()) @map("criado_em")
  projetoId  String           @unique @map("projeto_id")
  
  projeto    Projeto          @relation(fields: [projetoId], references: [id], onDelete: Cascade)

  @@map("pagamento")
}
